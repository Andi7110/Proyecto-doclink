{% extends 'paciente/dashboard_base.html' %}
{% load static %}

{% block content %}
<main id="main-content" class="flex-grow-1 px-md-5 py-4">
  <div class="container">

    <div class="text-center mb-4">
      <h2 class="mb-3">游녻 Configuraci칩n del Perfil Paciente</h2>
      <img src="{% static 'img/logo.png' %}" alt="Logo DocLink" width="60" class="mb-3">
      <p class="text-muted">Edita tu informaci칩n personal.</p>
    </div>

    <form method="post" enctype="multipart/form-data" class="card p-4 shadow-sm">
      {% csrf_token %}

      <h4 class="mb-3">Informaci칩n Personal</h4>

      <div class="row">
        <div class="col-md-6 mb-3">
          {{ form.nombre.label_tag }}
          {{ form.nombre }}
          {% if form.nombre.errors %}
            <div class="text-danger">{{ form.nombre.errors }}</div>
          {% endif %}
        </div>

        <div class="col-md-6 mb-3">
          {{ form.apellido.label_tag }}
          {{ form.apellido }}
          {% if form.apellido.errors %}
            <div class="text-danger">{{ form.apellido.errors }}</div>
          {% endif %}
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          {{ form.correo.label_tag }}
          {{ form.correo }}
          {% if form.correo.errors %}
            <div class="text-danger">{{ form.correo.errors }}</div>
          {% endif %}
        </div>

        <div class="col-md-6 mb-3">
          {{ form.telefono.label_tag }}
          {{ form.telefono }}
          {% if form.telefono.errors %}
            <div class="text-danger">{{ form.telefono.errors }}</div>
          {% endif %}
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          {{ form.departamento.label_tag }}
          {{ form.departamento }}
          {% if form.departamento.errors %}
            <div class="text-danger">{{ form.departamento.errors }}</div>
          {% endif %}
        </div>

        <div class="col-md-6 mb-3">
          {{ form.municipio.label_tag }}
          {{ form.municipio }}
          {% if form.municipio.errors %}
            <div class="text-danger">{{ form.municipio.errors }}</div>
          {% endif %}
        </div>
      </div>

      <h4 class="mb-3 mt-4">Foto de Perfil</h4>

      <div class="mb-3 text-center">
        <div class="mb-3">
          {% if user.foto_perfil %}
            <img id="preview" src="{{ user.foto_perfil.url }}" alt="Foto de perfil actual" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
          {% else %}
            <img id="preview" src="https://via.placeholder.com/150x150/e9ecef/6c757d?text=Sin+Foto" alt="Foto de perfil predeterminada" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
          {% endif %}
        </div>
        <div class="mb-3">
          <label for="{{ form.foto_perfil.id_for_label }}" class="form-label">
            <i class="fas fa-camera"></i> Editar foto de perfil
          </label>
          {{ form.foto_perfil }}
          {% if form.foto_perfil.errors %}
            <div class="text-danger">{{ form.foto_perfil.errors }}</div>
          {% endif %}
          <small class="form-text text-muted">Formatos permitidos: JPG, PNG. Tama침o m치ximo: 5MB</small>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-4">
        <a href="{% url 'dashboard_paciente' %}" class="btn btn-secondary">Cancelar</a>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </div>
    </form>

  </div>
</main>

<script>
  document.getElementById('{{ form.foto_perfil.id_for_label }}').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('preview').src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
</script>
{% endblock %}